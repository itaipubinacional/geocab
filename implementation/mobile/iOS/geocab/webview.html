<!--
 webview.html
 
 Created by Joaz Vieira Soares on 05/05/15.
 Copyright (c) 2014 Itaipu.
!-->
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">    
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

	<link rel="stylesheet" href="ol.css" type="text/css">
    <link rel="stylesheet" href="webview.css" type="text/css">
    <link rel="stylesheet" href="jquery.mobile.custom.structure.min.css" type="text/css">
	<link rel="stylesheet" href="jquery.mobile.min.css" type="text/css">
            
	<script src="ol.js" type="text/javascript"></script>
	<script src="jquery-2.1.1.min.js" type="text/javascript"></script>
	<script src="jquery.mobile.min.js" type="text/javascript"></script>
	<script src="jquery.touchSwipe.min.js" type="text/javascript"></script>
	<script src="geocab.app.js" type="text/javascript"></script>
	<script src="geocab.swipe.app.js" type="text/javascript"></script>
	<script src="geocab.marker.app.js" type="text/javascript"></script>
</head>

<body>

    <div id="map" class="map">

        <div id="action-state">
            <div class="add-point"></div>
        </div>

        <div id="add-state" class="hide">
            <div class="save-point"></div>
            <div class="cancel-point"></div>
            <div class="center-marker"></div>
        </div>

    </div>
    
    <div id="marker-template">
        <div  class="marker-info-box marker-t">
            <div class="marker-info-header">
                <p class="marker-title"></p>
                <div class="marker-info-close"></div>
            </div>
            <div class="marker-info-action">
                <div class="marker-action update">
                    <a href="" id="editar">
                        <img src="edit2.png" />
                    </a>
                </div>
                <div class="marker-action remove">
                    <a href="" id="open-remove">
                        <img src="remove2.png" />
                    </a>
                </div>
                <div class="marker-action approve">
                    <a href="" id="aprovar">
                        <img src="approve2.png" />
                    </a>
                </div>
                <div class="marker-action refuse">
                    <a href="" id="open-refuse">
                        <img src="refuse2.png">
                    </a>
                </div>
            </div>
            
            <p class="marker-status"></p>
            
            <div class="marker-info-content"></div>
            
            <div data-role="popup" id="popup-refuse" data-transition="pop" data-position-to="window" data-tolerance="30,15,0,15" data-theme="a" data-corners="false" style="max-width:400px;">
                <form>
                    <div style="padding: 20px 20px 30px 20px">
                        <h4 style="margin: 0 0 20px 0">Recusar</h4>
                        <label for="un" class="ui-hidden-accessible"></label>
                        <select name="select-cause" id="select-cause" data-corners="false">
                        </select>
                        <label for="description" class="ui-hidden-accessible">Motivo:</label>
                        <textarea data-mini="true" rows="3" class="motivo-moderacao ui-shadow" name="description" id="description" data-corners="false"></textarea>
                        
                        <div style="float: right; padding: 10px">
                            <a href="#" data-rel="back" class="action-cause">cancelar</a>
                            <a href="" id="confirm-refuse" class="action-cause">confirmar</a>
                        </div>
                    </div>
                </form>
            </div>
            
            <div data-role="popup" id="popup-remove" data-overlay-theme="a" data-theme="a" style="max-width:400px;" class="ui-popup ui-body-c ui-overlay-shadow"  data-corners="false">
                <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content ui-body-d" role="main">
                    <h3 class="ui-title" style="font-size: 0.8em">Deseja realmente excluir o item?</h3>
                    <p style="font-size: 0.7em">Esta operação não poderá ser desfeita.</p>
                    <a href="#" data-role="button" data-inline="true" data-rel="back" data-theme="c" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-btn-inline">
                        <span class="ui-btn-inner ui-btn-corner-all" style="width: 70px; height: 40px; font-size: 0.8em">
                        <span class="ui-btn-text">Cancelar</span></span>
                    </a>
                    <a href="#" data-role="button" data-inline="true" data-rel="back" data-transition="flow" data-theme="b" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-b ui-shadow ui-btn-corner-all ui-btn-inline">
                        <span class="ui-btn-inner ui-btn-corner-all" style="width: 70px; height: 40px; font-size: 0.8em">
                        <span class="ui-btn-text" id="confirm-remove">Confirmar</span></span>
                    </a>
                </div>
            </div>
            
        </div>
    </div>

    <div id="layer-template">
        <div class="marker-info-box layer-t">
            <div class="marker-info-header">
                <p class="marker-title"></p>
                <div class="marker-info-close"></div>
            </div>		
            <div class="marker-info-content"></div>
        </div>   	
    </div>
    
    <span id="No" class="hide">Não</span>
    <span id="Yes" class="hide">Sim</span>
    
    <script type="text/javascript">
    $(document).ready(function() {
        
        var iOS = {
			changeToAddMarker : function(coordenates){
				changeToAddMarker(coordenates);
			},
			showLayerMarker : function(markerId, layers){
				showLayerMarker(markerId, layers);
			},
        	showOpenMenuButton : function(){
            	showOpenMenuButton();
			},
			closeOpenMenuButton : function(){
				closeOpenMenuButton();
			},
			changeToUpdateMarker : function(marker, image){
				changeToUpdateMarker(marker, image);
            },
			changeToRefuseMarker : function(marker, motive){
				changeToRefuseMarker(marker, motive);
			},
			changeToApproveMarker : function(marker){
				changeToApproveMarker(marker);
			},
			changeToRemoveMarker : function(marker){
				changeToRemoveMarker(marker);
			}
        };
                      
        geocabapp.init("map", iOS);
        geocabapp.marker.init();
                      
		$("#map").on("click", "#open-refuse", function(){
			$("#description").val("");
			$("#select-cause").selectedIndex = 0;
                     $("#popup-refuse").popup("open");
		});
                      
		$("#map").on("click", "#open-remove", function(){
			$("#popup-remove").popup("open");
        });

        $(".add-point").click(function(){
            geocabapp.changeToAddState();
        });

        $(".cancel-point").click(function(){
            geocabapp.changeToActionState();
        });

        $(".save-point").click(function(){
            geocabapp.changeToSaveState();
        });

        $("#map").on('click', '.marker-info-close', function(event){
            geocabapp.marker.hide(event);
        });
                      
        $("#map").on('click', '.marker-action.update', function(){
            geocabapp.marker.update();
        });
		
		$("#map").on('click', '.marker-action.approve', function(){
			geocabapp.marker.approve();
        });
		
		$(document).on('click', '#confirm-remove', function(){
			geocabapp.marker.remove();
		});
                      
		$(document).on('click', '#confirm-refuse', function(){
                     
			var motiveMarker = { motive : {} };
            motiveMarker.description = $("#description").val();
            motiveMarker.motive.id = $("#select-cause").val();
                     
            geocabapp.marker.refuse(motiveMarker);
                     
            $("#popup-refuse").popup("close");
                     
		});
                      
    });
    </script>

</body>

</html>